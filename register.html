<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 样式与login.html相同 -->
    <script>
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;

            if(password !== confirmPass) {
                toastr.error('两次密码不一致');
                return;
            }

            try {
                // 获取现有用户
                const res = await fetch('https://gitee.com/api/v5/repos/damian2021/8004/contents/1.txt', {
                    headers: { Authorization: 'Bearer 9e4e0289fbbcbbf9646aac16d1fe007a' }
                });
                const data = await res.json();
                const users = atob(data.content).split('\n');

                // 检查用户名是否存在
                if(users.some(u => u.startsWith(username + ':'))) {
                    toastr.error('用户名已存在');
                    return;
                }

                // 更新用户数据
                const newContent = data.content + '\n' + btoa(`${username}:${password}`);
                await fetch('https://gitee.com/api/v5/repos/damian2021/8004/contents/1.txt', {
                    method: 'PUT',
                    headers: { Authorization: 'Bearer 9e4e0289fbbcbbf9646aac16d1fe007a' },
                    body: JSON.stringify({
                        content: newContent,
                        message: '新用户注册',
                        sha: data.sha
                    })
                });

                toastr.success('注册成功');
                setTimeout(() => window.location.href = 'login.html', 1000);
            } catch (error) {
                toastr.error('注册失败: ' + error.message);
            }
        });
    </script>
</head>
<body>
    <div class="auth-card">
        <h3 class="text-center mb-4">用户注册</h3>
        <form id="registerForm">
            <div class="mb-3">
                <input type="text" class="form-control" id="regUsername" placeholder="用户名" required>
            </div>
            <div class="mb-3">
                <input type="password" class="form-control" id="regPassword" placeholder="密码" required>
            </div>
            <div class="mb-3">
                <input type="password" class="form-control" id="confirmPassword" placeholder="确认密码" required>
            </div>
            <button type="submit" class="btn btn-success w-100">注册</button>
        </form>
        <div class="text-center mt-3">
            <a href="login.html" class="text-decoration-none">已有账号？立即登录</a>
        </div>
    </div>
</body>
</html>
