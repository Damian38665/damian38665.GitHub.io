<div class="profile-box">
    <h1>个人中心 - ${localStorage.getItem('username')}</h1>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">修改密码</h5>
            <div class="mb-3">
                <input type="password" id="oldPassword" class="form-control" placeholder="旧密码">
            </div>
            <div class="mb-3">
                <input type="password" id="newPassword" class="form-control" placeholder="新密码">
            </div>
            <button class="btn btn-warning" onclick="changePassword()">修改密码</button>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">账户操作</h5>
            <button class="btn btn-danger" onclick="deleteAccount()">删除账户</button>
            <button class="btn btn-secondary" onclick="logout()">注销登录</button>
        </div>
    </div>
</div>

<script>
    // 修改密码
    async function changePassword() {
        const oldPass = document.getElementById('oldPassword').value;
        const newPass = document.getElementById('newPassword').value;
        
        // 验证旧密码
        const users = await getUsers();
        const currentUser = users.find(u => u.username === localStorage.getItem('username'));
        
        if (currentUser.password !== oldPass) {
            alert('旧密码错误！');
            return;
        }

        // 更新密码
        currentUser.password = newPass;
        await updateUsers(users);
        alert('密码修改成功！');
    }

    // 删除账户
    async function deleteAccount() {
        if (!confirm('确定要永久删除账户吗？')) return;
        
        const users = await getUsers();
        const newUsers = users.filter(u => u.username !== localStorage.getItem('username'));
        
        await updateUsers(newUsers);
        logout();
    }

    // 注销登录
    function logout() {
        localStorage.clear();
        location.href = 'login.html';
    }
</script>
