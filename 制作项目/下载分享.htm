<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub仓库浏览器</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .input-group {
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        input[type="text"] {
            padding: 8px;
            width: 200px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }

        button {
            padding: 8px 16px;
            background-color: #2ea44f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #22863a;
        }

        .breadcrumb {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .breadcrumb a {
            color: #0366d6;
            text-decoration: none;
            transition: color 0.3s;
        }

        .breadcrumb a:hover {
            color: #054da1;
        }

        .file-list {
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .file-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item img {
            margin-right: 8px;
            width: 20px;
            height: 20px;
        }

        .download-link {
            color: #0366d6;
            text-decoration: none;
            margin-left: auto;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .download-link:hover {
            background-color: #f6f8fa;
        }

        .search-container {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        .search-container input {
            flex: 1;
        }

        .welcome-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ea44f;
            color: white;
            padding: 15px 25px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="input-group">
        <input type="text" id="repo" placeholder="用户名/仓库名 (例如: octocat/hello-world)">
        <input type="text" id="branch" placeholder="分支名 (默认: main)" value="main">
        <button onclick="loadRepository()">加载仓库</button>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="搜索文件或文件夹..." oninput="filterContents()">
    </div>

    <div class="breadcrumb" id="breadcrumb"></div>
    <div class="file-list" id="fileList"></div>

    <script>
        // 显示欢迎通知
        function showWelcomeNotification() {
            const notification = document.createElement('div');
            notification.className = 'welcome-notification';
            notification.textContent = '欢迎来到GitHub仓库浏览器！';
            document.body.appendChild(notification);

            // 3秒后自动消失
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 500);
            }, 3000);
        }

        let currentRepo = null;
        let currentPath = [];
        let allContents = [];

        // 页面加载完成后显示欢迎通知
        document.addEventListener('DOMContentLoaded', showWelcomeNotification);

        async function loadRepository() {
            const repoInput = document.getElementById('repo').value;
            const branchInput = document.getElementById('branch').value || 'main';
            
            if (!repoInput.includes('/')) {
                alert('请输入正确的仓库格式：用户名/仓库名');
                return;
            }

            currentRepo = {
                owner: repoInput.split('/')[0],
                repo: repoInput.split('/')[1],
                branch: branchInput
            };

            currentPath = [];
            await loadContents();
        }

        async function loadContents() {
            if (!currentRepo) return;

            const path = currentPath.join('/');
            const apiUrl = `https://api.github.com/repos/${currentRepo.owner}/${currentRepo.repo}/contents/${path}?ref=${currentRepo.branch}`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('请求失败');
                
                const contents = await response.json();
                allContents = contents;
                renderBreadcrumb();
                filterContents();
            } catch (error) {
                alert('错误: ' + error.message);
            }
        }

        function filterContents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allContents.filter(item => 
                item.name.toLowerCase().includes(searchTerm)
            );
            renderFileList(filtered);
        }

        function renderBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            let pathParts = [];
            let html = '<a href="#" onclick="navigateTo(-1)">根目录</a>';

            currentPath.forEach((part, index) => {
                pathParts.push(part);
                html += ` / <a href="#" onclick="navigateTo(${index})">${part}</a>`;
            });

            breadcrumb.innerHTML = html;
        }

        function navigateTo(index) {
            if (index === -1) {
                currentPath = [];
            } else {
                currentPath = currentPath.slice(0, index + 1);
            }
            loadContents();
        }

        function renderFileList(contents) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            contents.forEach(item => {
                const div = document.createElement('div');
                div.className = 'file-item';
                
                if (item.type === 'dir') {
                    div.innerHTML = `
                        <img src="https://cdn-icons-png.flaticon.com/512/716/716784.png" alt="文件夹">
                        <a href="#" onclick="enterFolder('${item.name}')">${item.name}</a>
                    `;
                } else {
                    const downloadUrl = `https://raw.githubusercontent.com/${currentRepo.owner}/${currentRepo.repo}/${currentRepo.branch}/${item.path}`;
                    div.innerHTML = `
                        <img src="https://cdn-icons-png.flaticon.com/512/136/136528.png" alt="文件">
                        ${item.name}
                        <a href="${downloadUrl}" class="download-link" download>下载</a>
                    `;
                }

                fileList.appendChild(div);
            });
        }

        function enterFolder(folderName) {
            currentPath.push(folderName);
            loadContents();
        }
    </script>
</body>
</html>
